<!DOCTYPE html>
<html class="dark" lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Fuegos Pedidos • Telegram Game Room</title>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">tailwind.config={darkMode:'class',theme:{extend:{colors:{primary:'#06e4f9','background-dark':'#0B0E14',accent:'#22d3ee',card:'#121A2B',text:'#E6EDF3',glass:'rgba(255,255,255,0.1)'}}}};</script>
  <style>body{min-height:max(884px,100dvh)}</style>
</head>
<body class="bg-background-dark font-display text-text">
  <div class="max-w-3xl mx-auto p-4 space-y-4">
    <h1 class="text-2xl font-bold text-center">Fuegos Pedidos</h1>
    <div class="bg-card border border-glass rounded-lg p-3 grid grid-cols-1 md:grid-cols-4 gap-2 items-end">
      <div class="md:col-span-2">
        <label class="text-xs text-text/70">Admin Username</label>
        <input id="admUser" class="w-full bg-background-dark border border-glass rounded-lg p-2" placeholder="usuario" />
      </div>
      <div class="md:col-span-1">
        <label class="text-xs text-text/70">Admin Code</label>
        <input id="admCode" class="w-full bg-background-dark border border-glass rounded-lg p-2" placeholder="código" />
      </div>
      <button id="saveAdm" class="bg-accent text-background-dark font-bold py-2 rounded-lg">Guardar</button>
    </div>
    <div class="bg-card border border-glass rounded-lg p-3 space-y-2">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2 text-sm">
          <button data-st="pending" class="st-btn bg-accent/20 text-accent px-3 py-1 rounded-lg">Pendientes</button>
          <button data-st="accepted" class="st-btn bg-glass hover:bg-accent/10 px-3 py-1 rounded-lg">Aceptadas</button>
          <button data-st="rejected" class="st-btn bg-glass hover:bg-accent/10 px-3 py-1 rounded-lg">Rechazadas</button>
        </div>
        <button id="refresh" class="text-sm bg-glass hover:bg-accent/20 px-3 py-1 rounded-lg">Refrescar</button>
      </div>
      <div id="list" class="space-y-2"></div>
    </div>
  </div>
  <script>
    const $=id=>document.getElementById(id);
    function headers(){
      const u=sessionStorage.getItem('admUser')||'';
      const c=sessionStorage.getItem('admCode')||'';
      const h={};
      if(u) h['x-admin-username']=u;
      if(c) h['x-admin-code']=c;
      return h;
    }
    let curStatus='pending';
    async function load(){
      const path = curStatus==='pending' ? '/api/economy/fire-requests/pending' : `/api/economy/fire-requests/list?status=${encodeURIComponent(curStatus)}`;
      const r=await fetch(path,{headers:headers()});
      const j=await r.json();
      const cont=$('list');
      cont.innerHTML='';
      if(!(j&&j.success)) return;
      for(const it of j.items){
        const el=document.createElement('div');
        el.className='flex items-center justify-between bg-background-dark p-3 rounded-lg';
        el.innerHTML=`<div><div class="font-bold">${it.userId}</div><div class="text-sm text-text/70">${it.reference}</div></div><div class="flex items-center gap-2"><span class="text-orange-400 font-bold">${it.amount}</span><span class="material-symbols-outlined text-orange-400" style="font-variation-settings:'FILL' 1;">local_fire_department</span></div><div class='flex items-center gap-2'><button data-id='${it.id}' class='btn-rej bg-error/20 text-error px-3 py-1 rounded-lg'>Rechazar</button><button data-id='${it.id}' class='btn-acc bg-success/20 text-success px-3 py-1 rounded-lg'>Aceptar</button></div>`;
        cont.appendChild(el);
      }
      for(const b of document.querySelectorAll('.btn-acc')){
        b.addEventListener('click',async(e)=>{
          const id=e.currentTarget.getAttribute('data-id');
          const r=await fetch(`/api/economy/fire-requests/${encodeURIComponent(id)}/accept`,{method:'POST',headers:Object.assign({'Content-Type':'application/json'},headers()),body:'{}'});
          const j=await r.json();
          await load();
          if(!(j&&j.success)) alert('Error al aceptar');
        });
      }
      for(const b of document.querySelectorAll('.btn-rej')){
        b.addEventListener('click',async(e)=>{
          const id=e.currentTarget.getAttribute('data-id');
          const r=await fetch(`/api/economy/fire-requests/${encodeURIComponent(id)}/reject`,{method:'POST',headers:Object.assign({'Content-Type':'application/json'},headers()),body:'{}'});
          const j=await r.json();
          await load();
          if(!(j&&j.success)) alert('Error al rechazar');
        });
      }
    }
    $('saveAdm').addEventListener('click',()=>{
      sessionStorage.setItem('admUser',$('admUser').value||'');
      sessionStorage.setItem('admCode',$('admCode').value||'');
      load();
    });
    $('refresh').addEventListener('click',load);
    for(const b of document.querySelectorAll('.st-btn')){
      b.addEventListener('click', (e)=>{
        for(const x of document.querySelectorAll('.st-btn')) x.className='st-btn bg-glass hover:bg-accent/10 px-3 py-1 rounded-lg';
        e.currentTarget.className='st-btn bg-accent/20 text-accent px-3 py-1 rounded-lg';
        curStatus = e.currentTarget.getAttribute('data-st')||'pending';
        load();
      });
    }
    window.addEventListener('load',()=>{
      $('admUser').value=sessionStorage.getItem('admUser')||'';
      $('admCode').value=sessionStorage.getItem('admCode')||'';
      load();
    });
  </script>
</body>
</html>
