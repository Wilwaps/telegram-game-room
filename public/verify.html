<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Verification</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script>tailwind.config={darkMode:'class',theme:{extend:{colors:{primary:'#4cecfa','background-light':'#f5f8f8','background-dark':'#0f2123'},fontFamily:{display:['Space Grotesk','sans-serif']},borderRadius:{DEFAULT:'0.75rem',lg:'1rem',xl:'1.5rem',full:'9999px'}}}};</script>
  <style>
    .material-symbols-outlined { font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24 }
    .code-input::-webkit-outer-spin-button, .code-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .code-input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body class="bg-background-dark font-display">
<div class="relative flex min-h-screen w-full flex-col items-center justify-center bg-[#0f2123] overflow-x-hidden p-6">
  <div class="flex h-full grow flex-col w-full max-w-md">
    <div class="flex flex-col items-center justify-center flex-1">
      <div class="flex flex-col w-full gap-8">
        <div class="flex flex-col items-center gap-3 p-4 text-center">
          <p class="text-white text-4xl font-black">Enter Verification Code</p>
          <p class="text-[#8ec7cc] text-base max-w-xs">A 6-digit code has been sent to your email address.</p>
        </div>
        <div class="flex flex-col gap-6">
          <div class="flex items-center justify-center gap-2 sm:gap-3">
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
            <span class="text-white text-xl font-bold">-</span>
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
            <input class="form-input code-input w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-primary border-none bg-[#21474a]" maxlength="1" type="number"/>
          </div>
          <div class="flex flex-col items-center justify-center pt-2">
            <button id="btnVerify" class="flex items-center justify-center w-full h-14 px-8 rounded-xl bg-primary text-background-dark text-base font-bold transition-transform duration-200 hover:scale-105">Verify</button>
            <p class="text-sm text-[#8ec7cc] mt-4">Didn't receive the code? <button id="btnResend" class="font-semibold text-primary hover:underline focus:outline-none">Resend Code</button></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function getEmail(){ const usp=new URLSearchParams(location.search); return usp.get('email')||''; }
  function collectCode(){ const d=[...document.querySelectorAll('.code-input')].map(i=>String(i.value||'').trim()).join(''); return d.replace(/\D/g,''); }
  async function post(url, data){ const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data||{})}); if(!r.ok){ let e; try{e=await r.json()}catch(_){e={}}; throw new Error(e&&e.error||('HTTP '+r.status)); } return r.json(); }
  document.getElementById('btnVerify').addEventListener('click', async ()=>{
    const email = getEmail(); if(!email){ alert('Falta email'); return; }
    const code = collectCode(); if(code.length!==6){ alert('Código inválido'); return; }
    try{
      await post('/api/auth/verify-email',{ email, code });
      window.location.href = '/login?verified=1';
    }catch(e){ alert('Verificación falló: '+e.message); }
  });
  document.getElementById('btnResend').addEventListener('click', async ()=>{
    const email = getEmail(); if(!email){ alert('Falta email'); return; }
    try{ await post('/api/auth/resend-code',{ email }); alert('Código reenviado'); }catch(e){ alert('Error al reenviar: '+e.message); }
  });
  // Autofocus
  const inputs = document.querySelectorAll('.code-input');
  inputs.forEach((inp,idx)=>{
    inp.addEventListener('input',()=>{ if(String(inp.value||'').length>0 && inputs[idx+1]) inputs[idx+1].focus(); });
    inp.addEventListener('keydown',(e)=>{ if(e.key==='Backspace' && !inp.value && inputs[idx-1]) inputs[idx-1].focus(); });
  });
  if (inputs[0]) inputs[0].focus();
</script>
</body>
</html>
