<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Sala de Juegos Multijugador - Tic Tac Toe en tiempo real">
    <meta name="theme-color" content="#4f46e5">
    <title>Sala de Juegos - Tic Tac Toe</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Socket.io Client -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/splash.css">
    <link rel="stylesheet" href="css/lobby.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/bingo.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- Preconnect para mejor rendimiento -->
    <link rel="preconnect" href="https://telegram.org">
    <link rel="preconnect" href="https://cdn.socket.io">
</head>
<body>
    
    <!-- ========================================== -->
    <!-- PANTALLA DE SPLASH -->
    <!-- ========================================== -->
    <div id="splash-screen" class="screen active">
        <div class="splash-container">
            <div class="splash-logo">üéÆ</div>
            <h1 class="splash-title">Sala de Juegos</h1>
            <p class="splash-subtitle">Tic Tac Toe Multijugador</p>
                <div class="splash-dot"></div>
                <div class="splash-dot"></div>
                <div class="splash-dot"></div>
            </div>
        <!-- Cierre de pantalla de splash para no anidar el resto de pantallas dentro -->
    </div>

    

    <!-- Modal crear Bingo -->
    <div id="bingo-config-modal" class="modal">
        <div class="modal-overlay" data-close="bingo-config-modal"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear sala de Bingo</h3>
                <button class="modal-close" data-close="bingo-config-modal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Modo de juego</label>
                    <select id="bingo-mode-select" class="input">
                        <option value="line">L√≠nea</option>
                        <option value="double">Doble L√≠nea</option>
                        <option value="full">Cart√≥n lleno</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cartones para el anfitri√≥n</label>
                    <div class="counter">
                        <button id="bingo-host-cards-decrease" class="counter-btn">-</button>
                        <input id="bingo-host-cards" class="counter-value" value="1" readonly>
                        <button id="bingo-host-cards-increase" class="counter-btn">+</button>
                    </div>
                    <p class="bingo-cost-hint">Costo: <span id="bingo-host-cost">1 üî•</span></p>
                </div>
                <div class="form-group">
                    <label>Modo de canto</label>
                    <label class="toggle">
                        <input type="checkbox" id="bingo-auto-draw">
                        <span>Autocantar n√∫meros</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="bingo-config-modal">Cancelar</button>
                <button id="confirm-create-bingo" class="btn btn-primary">Crear Sala</button>
            </div>
        </div>
    </div>

    <!-- Modal unirse a Bingo -->
    <div id="bingo-join-modal" class="modal">
        <div class="modal-overlay" data-close="bingo-join-modal"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Unirse a Bingo</h3>
                <button class="modal-close" data-close="bingo-join-modal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>C√≥digo de sala</label>
                    <input id="bingo-room-code" class="input" placeholder="ABC123" maxlength="6">
                </div>
                <div class="form-group">
                    <label>Cartones</label>
                    <div class="counter">
                        <button id="bingo-cards-decrease" class="counter-btn">-</button>
                        <input id="bingo-cards-count" class="counter-value" value="1" readonly>
                        <button id="bingo-cards-increase" class="counter-btn">+</button>
                    </div>
                    <p class="bingo-cost-hint">Costo: <span id="bingo-total-cost">1 üî•</span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="bingo-join-modal">Cancelar</button>
                <button id="confirm-join-bingo" class="btn btn-primary">Unirse</button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA DE AUTENTICACI√ìN -->
    <!-- ========================================== -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="auth-icon">üîê</div>
            <h2 class="auth-title">Autenticando</h2>
            <p class="auth-message">Verificando tu identidad de Telegram...</p>
            <div class="auth-loader">
                <div class="auth-spinner"></div>
            </div>
            <p class="auth-hint">Esto solo tomar√° un momento</p>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA DE CARGA -->
    <!-- ========================================== -->
    <div id="loading-screen" class="screen">
        <div class="loading-container">
            <div class="loader"></div>
            <p class="loading-text" id="loading-text">Conectando...</p>
            <p class="loading-subtext" id="loading-subtext">Preparando la sala de juegos</p>
        </div>
    </div>

    <!-- LOBBY - LISTA DE SALAS -->
    <!-- ========================================== -->
    <div id="lobby-screen" class="screen">
        <!-- Header -->
        <div class="header">
          <div class="header-left">
            <h1 class="title">üéÆ Sala de Juegos</h1>
            <p class="subtitle">Tic Tac Toe Multijugador</p>
          </div>
          <div class="header-right">
            <div class="user-info">
              <img id="user-avatar" src="" alt="Avatar" class="user-avatar">
              <div class="user-details">
                <span id="user-name" class="user-name">Usuario</span>
                <span id="user-level" class="user-level">Nivel 1</span>
              </div>
            </div>
            <div class="fires-badge" title="Fuegos disponibles">
              <span class="fires-icon">üî•</span>
              <span id="fires-count" class="fires-count">0</span>
            </div>
          </div>
        </div>

        <!-- Bot√≥n de estad√≠sticas unificado -->
        <div class="stats-unified">
          <button id="stats-button" class="btn btn-secondary btn-block" title="Ver estad√≠sticas">
            <span class="stat-chip">üèÜ <span id="wins">0</span></span>
            <span class="stat-chip">‚ùå <span id="losses">0</span></span>
            <span class="stat-chip">ü§ù <span id="draws">0</span></span>
            <span class="stat-chip">üî• <span id="fires-inline">0</span></span>
          </button>
        </div>

        <!-- Selector de juego -->
        <div class="game-selector">
            <div class="game-card" id="select-tictactoe">
                <div class="game-icon">‚ùå‚≠ï</div>
                <div class="game-info">
                    <h3>Tic Tac Toe</h3>
                    <p>Partidas r√°pidas 1 vs 1</p>
                </div>
                <div class="game-actions">
                    <button id="create-room-btn" class="btn btn-primary btn-small">Crear</button>
                    <button id="join-code-btn" class="btn btn-secondary btn-small">Unirse</button>
                </div>
            </div>
            <div class="game-card" id="select-bingo">
                <div class="game-icon">üé±</div>
                <div class="game-info">
                    <h3>Bingo</h3>
                    <p>Hasta 30 jugadores en simult√°neo</p>
                </div>
                <div class="game-actions">
                    <button id="create-bingo-btn" class="btn btn-primary btn-small">Crear</button>
                    <button id="join-bingo-btn" class="btn btn-secondary btn-small">Unirse</button>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de salas -->
        <div class="rooms-section">
            <div class="section-header">
                <h2 class="section-title">Salas Disponibles</h2>
                <button id="refresh-rooms-btn" class="btn-icon-small">
                    <span>üîÑ</span>
                </button>
            </div>
            
            <!-- Filtros de salas -->
            <div class="filter-tabs">
                <button class="tab active" data-filter="all">
                    <span>Todas</span>
                    <span class="tab-badge" id="all-count">0</span>
                </button>
                <button class="tab" data-filter="waiting">
                    <span>Esperando</span>
                    <span class="tab-badge" id="waiting-count">0</span>
                </button>
            </div>
            
            <!-- Lista de salas -->
            <div id="rooms-list" class="rooms-list">
                <!-- Las salas se cargar√°n din√°micamente -->
                <div class="empty-state">
                    <div class="empty-icon">üéÆ</div>
                    <p class="empty-title">No hay salas disponibles</p>
                    <p class="empty-text">Crea una nueva partida para comenzar</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- SALA DE ESPERA (Tic Tac Toe) -->
    <!-- ========================================== -->
    <div id="waiting-room-screen" class="screen">
        <div class="waiting-container">
            <!-- Header de sala -->
            <div class="waiting-header">
                <button id="back-to-lobby-btn" class="btn-back">
                    <span>‚Üê</span>
                </button>
                <h2 class="waiting-title">Sala de Espera</h2>
                <div class="waiting-status">
                    <span class="status-dot"></span>
                    <span>Esperando...</span>
                </div>
            </div>

            <!-- C√≥digo de sala -->
            <div class="room-code-section">
                <label class="room-code-label">C√≥digo de Sala</label>
                <div class="room-code-display">
                    <span id="room-code-display" class="room-code-text">------</span>
                    <button id="copy-code-btn" class="btn-icon-small" title="Copiar c√≥digo">
                        <span>üìã</span>
                    </button>
                </div>
                <p class="room-code-hint">Comparte este c√≥digo con tus amigos</p>
            </div>

            <!-- Jugadores -->
            <div class="players-waiting">
                <div class="player-slot filled" id="host-slot">
                    <div class="player-avatar-wrapper">
                        <img id="host-avatar" src="" alt="Host" class="player-avatar">
                        <div class="player-symbol player-x">‚ùå</div>
                    </div>
                    <div class="player-info">
                        <span id="host-name" class="player-name">Jugador 1</span>
                        <span class="player-badge host-badge">Host</span>
                    </div>
                </div>

                <div class="vs-divider">
                    <span class="vs-text">VS</span>
                </div>

                <div class="player-slot empty" id="guest-slot">
                    <div class="player-avatar-wrapper waiting-pulse">
                        <div class="player-avatar-placeholder">
                            <span>?</span>
                        </div>
                        <div class="player-symbol player-o">‚≠ï</div>
                    </div>
                    <div class="player-info">
                        <span class="player-name">Esperando jugador...</span>
                    </div>
                </div>
            </div>

            <!-- Acciones de sala de espera -->
            <div class="waiting-actions">
                <button id="invite-friends-btn" class="btn btn-primary">
                    <span class="btn-icon">üì§</span>
                    <span class="btn-text">Invitar Amigos</span>
                </button>
                <button id="make-public-btn" class="btn btn-secondary">
                    <span class="btn-icon">üåê</span>
                    <span class="btn-text">Hacer Sala P√∫blica</span>
                </button>
                <button id="leave-waiting-btn" class="btn btn-danger">
                    <span class="btn-icon">‚ùå</span>
                    <span class="btn-text">Salir de la Sala</span>
                </button>
            </div>

            <!-- Mensaje informativo -->
            <div class="info-message">
                <span class="info-icon">üí°</span>
                <p>Comparte el c√≥digo o invita amigos para comenzar la partida</p>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- SALA DE ESPERA BINGO -->
    <!-- ========================================== -->
    <div id="bingo-waiting-screen" class="screen">
        <div class="bingo-waiting">
            <div class="bingo-waiting-header">
                <button id="bingo-back-btn" class="btn-icon">‚Üê</button>
                <div>
                    <h2>Sala de Bingo</h2>
                    <p class="bingo-share" id="bingo-share-code">C√≥digo: -----</p>
                </div>
                <div class="bingo-pot">üî• Pot: <span id="bingo-pot">0</span></div>
            </div>

            <div class="bingo-waiting-content">
                <div class="bingo-players-panel">
                    <h3>Jugadores</h3>
                    <div id="bingo-players-list" class="bingo-players-list"></div>
                </div>
                <div class="bingo-waiting-actions">
                    <button id="bingo-invite-btn" class="btn btn-secondary">Invitar</button>
                    <button id="bingo-leave-btn" class="btn btn-danger">Salir</button>
                    <button id="bingo-start-btn" class="btn btn-primary">Iniciar partida</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA BINGO -->
    <!-- ========================================== -->
    <div id="bingo-game-screen" class="screen bingo-screen">
        <div class="bingo-header">
            <div class="bingo-header-left">
                <button id="bingo-exit-btn" class="btn-icon">‚Üê</button>
                <div>
                    <h2>Bingo</h2>
                    <p id="bingo-mode-label" class="subtitle">Modo l√≠nea</p>
                </div>
            </div>
            <div class="bingo-header-right">
                <div class="bingo-pot">üî• Pot: <span id="bingo-game-pot">0</span></div>
                <div class="bingo-players-counter">üë• <span id="bingo-players-count">0</span>/30</div>
            </div>
        </div>

        <div class="bingo-main">
            <div class="bingo-draw-board">
                <div class="bingo-recent-draws">
                    <h3>√öltimas fichas</h3>
                    <div id="bingo-recent-draws" class="bingo-recent-draws-list"></div>
                </div>
                <div id="bingo-draw-grid" class="bingo-draw-grid"></div>
            </div>

            <div class="bingo-cards-area">
                <div class="bingo-cards-header">
                    <h3>Tus cartones</h3>
                    <button id="bingo-claim-btn" class="btn btn-success" disabled>¬°Bingo!</button>
                </div>
                <div id="bingo-cards-grid" class="bingo-cards-grid"></div>
            </div>
        </div>

        <div class="bingo-actions">
            <button id="bingo-draw-btn" class="btn btn-primary">Cantar siguiente</button>
            <button id="bingo-leave-game-btn" class="btn btn-secondary">Salir</button>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA DE JUEGO -->
    <!-- ========================================== -->
    <div id="game-screen" class="screen">
        <!-- Header del juego -->
        <div class="game-header">
            <!-- Jugador X -->
            <div class="player-panel player-x-panel" id="player-x-panel">
                <img id="player-x-avatar" src="" alt="Player X" class="game-avatar">
                <div class="player-game-info">
                    <span id="player-x-name" class="player-game-name">Jugador X</span>
                    <div class="player-symbol-badge">
                        <span class="symbol-icon">‚ùå</span>
                        <span class="symbol-text">X</span>
                    </div>
                </div>
            </div>
            
            <!-- Indicador de turno y temporizador -->
            <div class="game-status-panel">
                <div id="turn-indicator" class="turn-indicator">
                    <span id="current-turn-text" class="turn-text">Tu turno</span>
                </div>
                <div id="timer-container" class="timer-container">
                    <svg class="timer-circle" width="60" height="60">
                        <circle class="timer-circle-bg" cx="30" cy="30" r="25"></circle>
                        <circle id="timer-circle-progress" class="timer-circle-progress" cx="30" cy="30" r="25"></circle>
                    </svg>
                    <span id="timer" class="timer-text">30</span>
                </div>
                <div class="game-moves-counter">
                    <span>Movimientos: </span>
                    <span id="moves-count">0</span>
                </div>
            </div>

            <!-- Jugador O -->
            <div class="player-panel player-o-panel" id="player-o-panel">
                <img id="player-o-avatar" src="" alt="Player O" class="game-avatar">
                <div class="player-game-info">
                    <span id="player-o-name" class="player-game-name">Jugador O</span>
                    <div class="player-symbol-badge">
                        <span class="symbol-icon">‚≠ï</span>
                        <span class="symbol-text">O</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tablero de juego -->
        <div class="game-board-container">
            <div id="game-board" class="game-board">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
            
            <!-- L√≠nea de victoria -->
            <svg class="winning-line" id="winning-line">
                <line x1="0" y1="0" x2="0" y2="0" stroke="var(--color-success)" stroke-width="8" stroke-linecap="round"/>
            </svg>
        </div>

        <!-- Acciones del juego -->
        <div class="game-actions">
            <button id="leave-game-btn" class="btn btn-secondary">
                <span class="btn-icon">üö™</span>
                <span class="btn-text">Salir</span>
            </button>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA DE RESULTADOS -->
    <!-- ========================================== -->
    <div id="result-screen" class="screen">
        <div class="result-container">
            <!-- Animaci√≥n de resultado -->
            <div class="result-animation" id="result-animation">
                <div class="result-icon" id="result-icon">üèÜ</div>
            </div>
            
            <!-- T√≠tulo y mensaje -->
            <h2 id="result-title" class="result-title">¬°Victoria!</h2>
            <p id="result-message" class="result-message">Has ganado la partida</p>

            <!-- Estad√≠sticas de la partida -->
            <div class="result-stats">
                <div class="result-stat-item">
                    <span class="result-stat-icon">‚è±Ô∏è</span>
                    <div class="result-stat-content">
                        <span class="result-stat-label">Duraci√≥n</span>
                        <span class="result-stat-value" id="game-duration">0:00</span>
                    </div>
                </div>
                <div class="result-stat-item">
                    <span class="result-stat-icon">üéØ</span>
                    <div class="result-stat-content">
                        <span class="result-stat-label">Movimientos</span>
                        <span class="result-stat-value" id="total-moves">0</span>
                    </div>
                </div>
            </div>

            <!-- Acciones de resultado -->
            <div class="result-actions">
                <button id="play-again-btn" class="btn btn-primary btn-large">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">Jugar de Nuevo</span>
                </button>
                <div class="result-secondary-actions">
                    <button id="share-result-btn" class="btn btn-secondary">
                        <span class="btn-icon">üì§</span>
                        <span class="btn-text">Compartir</span>
                    </button>
                    <button id="back-lobby-result-btn" class="btn btn-secondary">
                        <span class="btn-icon">üè†</span>
                        <span class="btn-text">Lobby</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL DE C√ìDIGO -->
    <!-- ========================================== -->
    <div id="code-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Unirse a Sala</h3>
                <button id="close-modal-btn" class="btn-close">
                    <span>√ó</span>
                </button>
            </div>
            <div class="modal-body">
                <label for="room-code-input" class="input-label">C√≥digo de Sala</label>
                <input 
                    type="text" 
                    id="room-code-input" 
                    class="input-text" 
                    placeholder="Ingresa el c√≥digo (6 caracteres)" 
                    maxlength="6"
                    autocomplete="off"
                >
                <p class="input-hint">El c√≥digo debe tener 6 caracteres alfanum√©ricos</p>
            </div>
            <div class="modal-actions">
                <button id="join-room-btn" class="btn btn-primary">
                    <span class="btn-text">Unirse</span>
                </button>
                <button id="cancel-join-btn" class="btn btn-secondary">
                    <span class="btn-text">Cancelar</span>
                </button>
            </div>
        </div>
        </div>

    <!-- ========================================== -->
    <!-- TOAST / HISTORIAL DE FUEGOS -->
    <!-- ========================================== -->
    <div id="toast-container" class="toast-container"></div>

    <!-- FAB de Bienvenida (solo primera vez) -->
    <div id="welcome-fab" class="welcome-fab hidden" title="Bienvenida">üéÅ</div>

    <!-- Modal de Bienvenida -->
    <div id="welcome-modal" class="modal">
        <div class="modal-overlay" data-close="welcome-modal"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">¬°Bienvenido!</h3>
                <button id="welcome-close-btn" class="btn-close">√ó</button>
            </div>
            <div class="modal-body">
                <p id="welcome-message">Necesitas los fuegos para participar en las actividades. No te preocupes qu√© tambi√©n hay formas de ganarlos!! Disfruta tu tiempo en este espacio üéµ</p>
                <div class="mt-md" style="display:flex;align-items:center;gap:8px;">
                    <div class="fires-bonus-visual">üî• x10</div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="welcome-claim-btn" class="btn btn-primary">Reclamar 10 üî•</button>
            </div>
        </div>
    </div>

    <div id="fires-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Historial de Fuegos</h3>
                <button id="close-fires-modal" class="btn-close"><span>√ó</span></button>
            </div>
            <div class="modal-body">
                <div id="fires-history-empty" class="empty-state">
                    <div class="empty-icon">üî•</div>
                    <p class="empty-title">Sin movimientos a√∫n</p>
                    <p class="empty-text">Juega Tic Tac Toe o Bingo para generar movimientos.</p>
                </div>
                <div id="fires-history-list" class="fires-history-list"></div>
            </div>
            <div class="modal-actions">
                <button id="refresh-fires-history" class="btn btn-secondary">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- SCRIPTS -->
    <!-- ========================================== -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/socket-client.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/lobby.js"></script>
    <script src="js/waiting-room.js"></script>
    <script src="js/game.js"></script>
    <script src="js/economy.js"></script>
    <script src="js/bingo.js"></script>
    <script src="js/result.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
